{% extends "main.html" %}

{% block main %}


<h2 id="current_event_name">{{event.name}}</h2>

{% if event.has_video %}

<script type="text/javascript" src="/static/swfobject.js"></script> 

<div id="ytapiplayer"> 
    You need Flash player 8+ and JavaScript enabled to view this video.
</div> 

<script type="text/javascript"> 

    //TODO: hijack the vote buttons so that clicking them runs a js function
    //TODO: write the js function that is called when you click a vote button

    var rating = 2047;

    var videoId = "{{event.video_site_id}}";

    var params = { allowScriptAccess: "always" };
    var atts = { id: "myytplayer" };
    swfobject.embedSWF("http://www.youtube.com/v/"+videoId+"&enablejsapi=1&playerapiid=ytplayer","ytapiplayer", "425", "356", "8", null, null, params, atts);

    function onYouTubePlayerReady(playerId) {
        ytplayer = document.getElementById("myytplayer");
        ytplayer.addEventListener("onStateChange", "onytplayerStateChange");
    }

    duration = ytplayer.getDuration();

    var a = new Array();

    var intval="";

    // When the state of the video changes, we act accordingly
    function onytplayerStateChange(newState) {
        switch(newState) {
            case 0: // state: ended
                break;
            case 1: // state: playing
                break;
            case 2: // state: pause
                break;
            case 3: // state: buffering
                break;
        }
    }
</script> 

{% endif %}

    <form action="/process_vote_do" method="post" id="vote_heck_yes_form">
    <fieldset>
        <input type="hidden" name="weight" value="2" />
        <input type="hidden" name="event__pk" value="{{event.pk}}"/>
        <input type="submit" value="Heck Yes" />
    </fieldset>
    </form>

    <form action="/process_vote_do" method="post" id="vote_yes_form">
    <fieldset>
        <input type="hidden" name="weight" value="1" />
        <input type="hidden" name="event__pk" value="{{event.pk}}"/>
        <input type="submit" value="Yes" />
    </fieldset>
    </form>

    <br />

    <form action="/process_vote_do" method="post" id="vote_no_form">
    <fieldset>
        <input type="hidden" name="weight" value="-1" />
        <input type="hidden" name="event__pk" value="{{event.pk}}"/>
        <input type="submit" value="No" />
    </fieldset>
    </form>

    <form action="/process_vote_do" method="post" id="vote_heck_no_form">
    <fieldset>
        <input type="hidden" name="weight" value="-2" />
        <input type="hidden" name="event__pk" value="{{event.pk}}"/>
        <input type="submit" value=" Heck No" />
    </fieldset>
    </form>

    <p class="yourvotes">
    You've voted {{her_num_votes}} times.
    </p>

<h3 class="survey_info_header">Survey info:</h3>
    <form action="/process_user_do" method="post" id="user_info_form">
<fieldset style="border: none; padding: 0; margin: 0">
        <label>Name: </label>
        <input type="text" id="name" name="name" value="{{user.name}}"/>
	<label>Age: </label>
    <input type="text" id="age" name="age" value="{{user.age}}" />
	<label>Gender: </label>
	<input type="text" id="gender" name="gender" value="{{user.gender}}"  />
	<input type="hidden" name="from_event__pk" value="{{event.pk}}"/>
        <input type="submit" value="Submit info" />
</fieldset>
    </form>



<a href="/view_results/{{event.pk}}">View results</a>
{% endblock %}
